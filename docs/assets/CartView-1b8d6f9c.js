import{_ as W}from"./http-a024b3f6.js";import{g as q,r as G,u as I,a as $}from"./index-2a526f70.js";import{s as k}from"./index-83de5650.js";import{p as C,q as z,s as H,v as M,d as n,x as R,y as J,h as K,r as f,j as Q,k as X,z as Y,e as u,o as h,c as _,w as i,a as c,u as Z,F as y,i as B,b as ee,t as v}from"./index-811e683d.js";let g;const te={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let oe=C({},te);function le(){({instance:g}=H({setup(){const{state:m,toggle:r}=M();return()=>n(J,R(m,{"onUpdate:show":r}),null)}}))}function ne(d){return z?new Promise((m,r)=>{g||le(),g.open(C({},oe,d,{callback:a=>{(a==="confirm"?m:r)(a)}}))}):Promise.resolve()}const ae=d=>ne(C({showCancelButton:!0},d)),se={class:"h-screen pt-12 pb-28 overflow-y-scroll bg-sh-gray"},ce={class:"w-full inline-flex px-4 py-2 bg-white"},re=["src","alt"],ue={class:"flex-1 flex flex-col justify-around ml-1"},ie={class:"text-sm text-red-500 font-bold"},de={class:"flex flex-col justify-around"},me={class:"text-sm text-end text-red-500 font-bold"},ve={__name:"CartView",setup(d){const m=K(),r=f(null),a=f([]),p=f(!1),s=f([]),V=Q(()=>s.value.filter(e=>e.is_checked===1).reduce((e,t)=>e+t.num*t.goods.price,0)*100);X(()=>{q().then(e=>{s.value=e.data,a.value=e.data.filter(t=>t.is_checked===1).map(t=>t.id)}).catch(e=>{console.log(e.message)})}),Y(a,e=>{s.value.length===0||e.length!==s.value.length?p.value=!1:p.value=!0});const D=({name:e,position:t})=>{switch(t){case"cell":case"outside":return!0;case"right":ae({title:"确定删除吗？"}).then(()=>{O(e)}).catch(()=>{})}};function O(e){let t=s.value[e].id;G(t).then(l=>{l===""&&s.value.splice(e,1)}).catch(l=>{console.log(l.message)})}function P(e){k("更改中...",t=>{I(e,s.value.find(l=>l.id===e).num).then(l=>{l===""&&t.close()}).catch(l=>{console.log(l.message)})})}function w(){k("更改中...",e=>{$(a.value).then(t=>{t===""&&(L(),e.close())}).catch(t=>{console.log(t.message)})})}function S(){p.value?r.value.toggleAll(!0):r.value.toggleAll(!1),w()}function L(){s.value.forEach(e=>{a.value.includes(e.id)?e.is_checked=1:e.is_checked=0})}function N(){m.push("/order-preview")}return(e,t)=>{const l=u("van-checkbox"),U=u("van-stepper"),E=u("van-button"),T=u("van-swipe-cell"),A=u("van-checkbox-group"),F=u("van-list"),j=u("van-submit-bar");return h(),_(y,null,[n(W,null,{title:i(()=>[B("购物车")]),_:1}),c("main",se,[n(F,{class:"m-2"},{default:i(()=>[n(A,{ref_key:"checkGroupElm",ref:r,modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value=o)},{default:i(()=>[(h(!0),_(y,null,ee(s.value,(o,x)=>(h(),_("div",{class:"mb-2 shadow-sm rounded-lg overflow-auto",key:x},[n(T,{"before-close":D,name:x},{right:i(()=>[n(E,{class:"h-full border-none text-white bg-red-500",square:"",text:"删除"})]),default:i(()=>[c("div",ce,[n(l,{name:o.id,onClick:w},null,8,["name"]),c("img",{class:"w-1/4 py-1 bg-white rounded-md",src:o.goods.cover_url,alt:o.goods.description},null,8,re),c("div",ue,[c("h3",null,v(o.goods.title),1),c("p",ie,"￥"+v(o.goods.price),1)]),c("div",de,[c("p",me,"￥"+v(o.num*o.goods.price),1),n(U,{modelValue:o.num,"onUpdate:modelValue":b=>o.num=b,onChange:b=>P(o.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),_:2},1032,["name"])]))),128))]),_:1},8,["modelValue"])]),_:1}),n(j,{class:"bottom-16",price:Z(V),"button-text":"提交订单",onSubmit:N},{default:i(()=>[n(l,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o),onClick:S},{default:i(()=>[B("全选")]),_:1},8,["modelValue"])]),_:1},8,["price"])])],64)}}};export{ve as default};
