import{i as N,_ as I}from"./http-a024b3f6.js";import{r as d,e as _,o as l,f as k,w as g,c as b,b as w,F as y,h as A,j,a as u,t as C,u as D,d as p,k as P,l as U,i as q}from"./index-811e683d.js";const E={__name:"TopTab",props:{tabs:{type:Array,required:!0}},emits:["changeTab"],setup(o,{emit:s}){const c=d(0);function t(){s("changeTab",c.value)}return(a,n)=>{const h=_("van-tab"),r=_("van-tabs");return l(),k(r,{class:"shadow",active:c.value,"onUpdate:active":n[0]||(n[0]=m=>c.value=m),color:"#10B981",onClick:t},{default:g(()=>[(l(!0),b(y,null,w(o.tabs,(m,v)=>(l(),k(h,{key:v,title:m},null,8,["title"]))),128))]),_:1},8,["active"])}}},F=["src"],H={class:"flex-1 flex flex-col justify-between text-sm"},J={class:"flex flex-col"},M={class:"font-bold"},O={class:"text-gray-500 text-xs"},R={class:"flex justify-between"},z={class:"text-red-500 font-bold"},G={class:"text-yellow-500 font-bold"},K={__name:"BookCard",props:{book:{type:Object,required:!0}},setup(o){const s=o,c=A(),t=j(()=>s.book.updated_at.split("T")[0].split("-").join("."));function a(){c.push({name:"BookDetail",params:{id:s.book.id}})}return(n,h)=>(l(),b("div",{class:"flex bg-gray-100 p-2 rounded-md mb-2",onClick:a},[u("img",{src:o.book.cover_url,alt:"",class:"w-1/3 rounded-md mr-2"},null,8,F),u("div",H,[u("div",J,[u("span",M,C(o.book.title),1),u("span",O,C(D(t)),1)]),u("div",R,[u("span",z,"￥"+C(o.book.price),1),u("span",G,"销量："+C(o.book.sales),1)])])]))}},Q={class:"px-2 pt-4"},W={__name:"BookList",props:{books:{type:Array,required:!0}},setup(o){return(s,c)=>(l(),b("div",Q,[(l(!0),b(y,null,w(o.books,(t,a)=>(l(),k(K,{key:a,book:t},null,8,["book"]))),128))]))}},X={__name:"SideNav",props:{categroyList:{type:Array,required:!0}},emits:["passCatId"],setup(o,{emit:s}){const c=o,t=d(0),a=d(0),n=d({"sidebar-selected-border-color":"#10B981"});function h(){s("passCatId",c.categroyList[t.value].children[a.value].id)}function r(){a.value=0}return(m,v)=>{const T=_("van-sidebar-item"),x=_("van-sidebar"),V=_("van-config-provider"),$=_("van-collapse-item"),L=_("van-collapse");return l(),k(L,{modelValue:t.value,"onUpdate:modelValue":v[1]||(v[1]=e=>t.value=e),class:"h-full shadow-md",onChange:r,accordion:""},{default:g(()=>[(l(!0),b(y,null,w(o.categroyList,(e,i)=>(l(),k($,{key:i,title:e.name,name:i},{default:g(()=>[p(V,{"theme-vars":n.value},{default:g(()=>[p(x,{modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=f=>a.value=f),onChange:h},{default:g(()=>[(l(!0),b(y,null,w(e.children,(f,S)=>(l(),k(T,{key:S,title:f.name},null,8,["title"]))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["theme-vars"])]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])}}},Y=()=>N.get("/goods"),B=(o="sales",s,c=1)=>N.get(`/goods?${o}=1&category_id=${s}&page=${c}`),Z={class:"h-screen pt-12 pb-16"},ee={class:"flex h-full"},ae={class:"flex-1 flex flex-col"},se={__name:"CategoryView",setup(o){const s=d([{name:"前沿",children:[{name:"区块链"},{name:"人工智能"}]},{name:"前端",children:[{name:"小程序"},{name:"JavaScript"},{name:"HTML/CSS"},{name:"Vue"},{name:"React"},{name:"ES6"},{name:"Node.js"}]},{name:"后端",children:[{name:"Java"},{name:"PHP"},{name:"Python"},{name:"Go"}]},{name:"云计算",children:[{name:"私有云"},{name:"公有云"},{name:"混合云"}]},{name:"产品设计",children:[{name:"UI设计"},{name:"网站设计"}]}]),c=d(["销量","价格","评论"]),t=d(0),a=d({sales:{books:[],page:1},price:{books:[],page:1},comments:{books:[],page:1}}),n=d("sales"),h=j(()=>a.value[n.value].books),r=d(!1),m=d(!1);P(()=>{Y().then(e=>{s.value=e.categories.slice(0,5),t.value=e.categories[0].children[0].id,v(),x()}).catch(e=>{console.log(e.message)})});function v(){T(),U(()=>{Promise.all([B("sales",t.value),B("price",t.value),B("comments_count",t.value)]).then(([e,i,f])=>{a.value.sales.books=e.goods.data,a.value.price.books=i.goods.data,a.value.comments.books=f.goods.data,e.goods.data.length===0&&(r.value=!1,m.value=!0)}).catch(e=>{console.log(e.message)})})}function T(){r.value=!1,m.value=!1;for(const e in a.value)a.value[e].page=1}function x(){setTimeout(()=>{B(n.value,t.value,a.value[n.value].page+1).then(e=>{if(e.goods.data.length===0){r.value=!1,m.value=!0;return}a.value[n.value].books=a.value[n.value].books.concat(e.goods.data),a.value[n.value].page++,r.value=!1}).catch(e=>{console.log(e.message)})},600)}function V(e){n.value=["sales","price","comments"][e],r.value=!1,m.value=!1}function $(e){t.value=e,v()}function L(e){if(e==="")return;let i=s.value[e].children[0].id;i===t.value||i===void 0||(t.value=i,v())}return(e,i)=>{const f=_("van-list");return l(),b(y,null,[p(I,null,{title:g(()=>[q("图书分类")]),_:1}),u("main",Z,[u("section",ee,[p(X,{class:"w-1/3 z-10 overflow-y-scroll","categroy-list":s.value,onPassCatId:$,onChange:L},null,8,["categroy-list"]),u("div",ae,[p(E,{tabs:c.value,onChangeTab:V},null,8,["tabs"]),p(f,{class:"flex-1 overflow-y-scroll",loading:r.value,"onUpdate:loading":i[0]||(i[0]=S=>r.value=S),finished:m.value,"finished-text":"没有更多了","immediate-check":!1,offset:30,onLoad:x},{default:g(()=>[p(W,{books:D(h)},null,8,["books"])]),_:1},8,["loading","finished"])])])])],64)}}};export{se as default};
