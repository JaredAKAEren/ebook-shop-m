import{_ as N}from"./http-a024b3f6.js";import{a as T,c as k,u as q}from"./index-534a1249.js";import{s as C}from"./index-83de5650.js";import{h as F,r as c,j as g,k as I,e as u,o as p,c as v,d as r,w as h,a as e,u as f,F as w,i as _,t as l,b as L}from"./index-811e683d.js";const D={class:"bg-sh-gray h-screen py-12 flex"},E={class:"flex bg-white mb-4 mt-2 rounded-md shadow-sm p-4 border-l-4 rounded-l-md border-blue-500"},M={class:"flex flex-col flex-1 text-sm"},R={class:"flex text-lg items-center"},U=e("span",{class:"text-xs bg-blue-500 text-white ml-2 px-2 py-px rounded-full"},"默认",-1),z={class:"flex mt-2"},A={class:"w-full inline-flex px-4 py-2 bg-white"},G=["src","alt"],H={class:"flex-1 flex flex-col justify-around ml-1"},J={class:"text-sm text-red-500 font-bold"},K={class:"flex flex-col justify-around"},Q={class:"text-xs text-end text-gray-500"},W=e("small",{class:"text-xs mr-px"},"x",-1),X={class:"pt-1"},oe={__name:"OrderPreviewView",setup(Y){const y=F(),o=c({}),d=c([]),i=c({}),m=c(!1),b=c([{name:"支付宝",icon:"qrcode",type:"aliyun"}]),x=g(()=>({name:`${o.value.name} ${o.value.phone}`,address:`${o.value.province} ${o.value.city} ${o.value.county} ${o.value.address}`})),S=g(()=>d.value.reduce((s,t)=>s+t.num*t.goods.price,0)*100);I(()=>{T().then(s=>{o.value=s.address.find(t=>t.is_default),d.value=s.carts}).catch(s=>{console.log(s.message)})});function $(){m.value=!0,k(o.value.id).then(s=>{console.log(s),i.value=s}).catch(s=>{console.log(s.message)})}function O(s){i.value.id&&C("支付中...",t=>{q(i.value.id,s.type).then(n=>{console.log(n),t.message="支付成功，跳转中...",setTimeout(()=>{t.close(),y.replace({path:"/order-detail",query:{id:i.value.id}})},1e3)}).catch(n=>{console.log(n.message)})})}return(s,t)=>{const n=u("van-icon"),P=u("van-list"),V=u("van-submit-bar"),j=u("van-share-sheet");return p(),v(w,null,[r(N,null,{title:h(()=>[_("订单预览")]),_:1}),e("main",D,[r(P,{class:"overflow-y-scroll p-2"},{default:h(()=>[e("div",E,[e("div",M,[e("div",R,[e("p",null,l(f(x).name),1),U]),e("div",z,[e("p",null,l(f(x).address),1)])]),r(n,{class:"text-lg text-gray-500 font-bold self-center",name:"arrow"})]),(p(!0),v(w,null,L(d.value,(a,B)=>(p(),v("div",{class:"mb-2 mx-2 shadow-sm rounded-lg overflow-auto",key:B},[e("div",A,[e("img",{class:"w-1/4 py-1 bg-white rounded-md",src:a.goods.cover_url,alt:a.goods.description},null,8,G),e("div",H,[e("h3",null,l(a.goods.title),1),e("p",J,"￥"+l(a.goods.price),1)]),e("div",K,[e("p",Q,[W,_(l(a.num),1)])])])]))),128))]),_:1}),r(V,{class:"shadow",price:f(S),"button-text":"去支付",onSubmit:$},{default:h(()=>[e("p",X,[_("共 "),e("strong",null,l(d.value.length),1),_(" 件商品")])]),_:1},8,["price"]),r(j,{show:m.value,"onUpdate:show":t[0]||(t[0]=a=>m.value=a),title:"请选择支付方式",options:b.value,"cancel-text":"取消支付","close-on-click-overlay":!1,onSelect:O},null,8,["show","options"])])],64)}}};export{oe as default};
